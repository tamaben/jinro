<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Joy-Conäººç‹¼</title>
<style>
body{
  background:#111;
  color:white;
  text-align:center;
  font-family:sans-serif;
}
button{
  font-size:24px;
  padding:20px;
  margin:20px;
}
</style>
</head>

<body>

<h1>ğŸº äººç‹¼ã‚²ãƒ¼ãƒ </h1>

<button onclick="connectJoy()">ğŸ® Joy-Conæ¥ç¶š</button>
<button onclick="giveRole()">ğŸ² å½¹è·é…å¸ƒ</button>

<p id="msg">æ¥ç¶šã—ã¦ãã ã•ã„</p>

<script>

let device = null

// ===== Joy-Conæ¥ç¶šï¼ˆWebHIDï¼‰ =====
async function connectJoy(){

  device = await navigator.hid.requestDevice({
    filters:[{vendorId:0x057e}] // Nintendo
  })

  device = device[0]
  await device.open()

  msg.innerText = "æ¥ç¶šå®Œäº†ï¼"
}


// ===== 1å›æŒ¯å‹• =====
async function rumble(){

  if(!device) return

  const data = new Uint8Array([
    0x10,0x01,0x40,0x40,0x00,0x01,0x40,0x40
  ])

  await device.sendReport(0x10, data)
}


// ===== è¤‡æ•°å›æŒ¯å‹• =====
async function vibrate(times){

  for(let i=0;i<times;i++){
    await rumble()
    await new Promise(r=>setTimeout(r,250))
  }
}


// ===== å½¹è·é…å¸ƒ =====
function giveRole(){

  const role = Math.floor(Math.random()*5)+1

  vibrate(role)

  msg.innerText = "æŒ¯å‹•å›æ•°ã§ç¢ºèªï¼"
}

</script>
</body>
</html>
